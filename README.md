# Desktop Butler — ваш личный уборщик рабочего стола

## Что это и зачем?

Знакома ситуация: после пары дней интенсивной работы рабочий стол превращается в свалку? Повсюду разбросаны скриншоты, временные файлы, важные документы, нужные папки и какой-то `отчет_финал_готово_2.docx`. Найти что-то почти нереально, а удалять страшно — вдруг там что-то ценное?

**Desktop Butler** решает эту проблему. Это не просто скрипт, который тупо удаляет файлы. Это умный помощник, который:

* **Сортирует файлы** по типу в аккуратные папки: `картинки`, `документы`, `код` и так далее.
* **Обрабатывает папки как единое целое**. Он не будет разбирать ваши проектные папки по файлам, ломая все связи. Папка либо останется на месте, либо переедет целиком.
* **Умеет сжимать папки в ZIP-архивы**. Если вам нужно сохранить папку, но убрать её с глаз долой, Butler может её заархивировать.
* **Определяет важность файлов** по ключевым словам в названии, размеру и дате изменения.
* **Даёт вам полный контроль** через простой `config.yaml` файл. Вы сами решаете, что и как делать.

По сути, это инструмент, который я написал для себя, чтобы перестать тратить время на ручную уборку и сосредоточиться на работе. И он отлично справляется.

## Как этим пользоваться

### Что нужно для старта

* Установленный Python (версия 3.9 или новее).


### 1. Установка

Сначала нужно скачать проект и настроить окружение.

```bash
# Клонируем репозиторий (или просто скачиваем архив)
git clone https://github.com/ваш_логин/desktop-butler.git
cd desktop-butler

# Создаём и активируем виртуальное окружение
python -m venv .venv
```

Теперь активируем окружение.

**Для Windows (в PowerShell):**

```powershell
# Если появится ошибка, возможно, понадобится эта команда:
# Set-ExecutionPolicy -Scope Process -ExecutionPolicy RemoteSigned -Force
. .\.venv\Scripts\Activate.ps1
```

**Для Linux или macOS:**

```bash
source .venv/bin/activate
```


### 2. Установка зависимостей

Когда окружение активно, устанавливаем нужные пакеты одной командой:

```bash
pip install -r requirements.txt
```


### 3. Настройка

Это самый важный шаг.

1. Создайте в папке проекта файл `config.yaml` (можно скопировать и переименовать пример).
2. Откройте его и настройте под себя.
    * **Обязательно**: укажите `root_cleanup_dir`. Это папка, куда будут складываться все отсортированные файлы и папки.
    * **Обязательно**: просмотрите секцию `blacklist` и добавьте туда свои рабочие папки и файлы, которые трогать нельзя.
    * **Совет**: всегда оставляйте `dry_run: true` (режим симуляции), пока не будете уверены, что всё настроено правильно.

## Основные команды

Все команды запускаются из папки проекта, с активным виртуальным окружением. Флаг `--config` обязателен и должен идти *перед* названием команды.

> **Общий вид команды**: `python desktop_butler.py --config config.yaml <команда>`

* **Провести разовую уборку:**

```bash
python desktop_butler.py --config config.yaml scan-once
```

* **Включить наблюдение в реальном времени:**
Butler будет следить за рабочим столом и сразу же сортировать новые файлы. Чтобы остановить, нажмите `Ctrl+C`.

```bash
python desktop_butler.py --config config.yaml watch
```

* **Отменить последнюю уборку:**
Если что-то пошло не так, эта команда вернёт всё на свои места.

```bash
python desktop_butler.py --config config.yaml undo-last
```


## Настройки в `config.yaml`

Здесь живёт вся логика. Настройте файл под себя.

```yaml
# --- Основные пути ---
# Совет: используйте прямые слеши (/) для путей даже в Windows, 
# а тильда (~) автоматически заменится на вашу домашнюю папку.
root_cleanup_dir: "D:/Архив Рабочего Стола"
desktop_dir: "~/Desktop"
log_dir: "~/.desktop_butler/logs"
sessions_dir: "~/.desktop_butler/sessions"

# --- Безопасность и режимы работы ---
dry_run: true             # true: только симуляция, файлы не трогаются. false: реальная уборка. Начните с true.
delete_empty_folders: true  # true: пустые папки на рабочем столе будут удалены (если их нет в "чёрном списке").

# --- Правила "важности" файлов (без машинного обучения) ---
# Помогает отделить "мусор" от потенциально ценных файлов.
importance_rules:
  # Ключевые слова в имени файла, которые повышают его "важность".
  high_keywords: ["договор", "счет", "invoice", "контракт", "отчет", "презентация"]
  # Слова, которые, наоборот, понижают важность.
  low_keywords: ["скриншот", "screenshot", "copy", "temp", "draft"]
  # Файлы больше этого размера (в байтах) считаются важными.
  min_size_bytes_for_high: 200000 
  # Файлы, изменённые за последние N дней, считаются важными.
  recent_days_for_high: 7

# --- Обработка папок ---
# Здесь настраивается, что делать с папками на рабочем столе.
folders:
  handle: "atomic"                 # "atomic": обрабатывать папки как единое целое (перемещать/архивировать). "ignore": не трогать папки.
  quiet_period_sec: 30             # Сколько секунд "тишины" (без изменений) ждать, прежде чем обработать папку. Защищает от переноса папок, в которые ещё идёт запись.
  
  # Настройки сжатия папок в ZIP-архивы.
  compress:
    enabled: true                  # true: сжимать папки в ZIP. false: просто перемещать.
    method: "ZIP_DEFLATED"         # Метод сжатия. ZIP_DEFLATED — стандартный, хороший баланс.
    level: 6                       # Уровень сжатия (0-9 для ZIP_DEFLATED). 6 — золотая середина.
    remove_original_after_zip: false # true: удалять исходную папку после архивации. Оставьте false, пока не убедитесь, что архивы создаются корректно.

# --- "Чёрный список": то, что трогать нельзя ---
# Самая важная секция для защиты ваших данных!
blacklist:
  # Точные имена файлов или папок, которые нужно игнорировать.
  names: ["DO_NOT_TOUCH.txt"]
  # Расширения файлов, которые всегда нужно оставлять на месте.
  extensions: ["lnk"]
  # Полные пути к файлам или папкам.
  dirs:
    - "C:/Users/ВашеИмя/Desktop/Мой Супер Проект"
  # Шаблоны в стиле Unix. "*" — что угодно.
  patterns:
    - "*.tmp"
    - "секретно_*"

# --- Категории для сортировки файлов ---
# Здесь вы решаете, какие расширения в какую папку попадут.
categories:
  documents: [pdf, doc, docx, txt, rtf, md]
  spreadsheets: [csv, xls, xlsx]
  images: [jpg, jpeg, png, gif, svg, webp]
  video: [mp4, mov, avi, mkv]
  audio: [mp3, wav, flac]
  archives: [zip, rar, 7z]
  code: [py, js, html, css, java]
  #... и так далее, можно добавлять свои.
```


## Фишки и подводные камни

* **Безопасный режим (Dry Run)**. Пока в конфиге стоит `dry_run: true`, скрипт будет только писать в лог, что он *собирается* сделать. Файлы при этом не трогаются. Это отличный способ проверить настройки.
* **"Чёрный список" — ваш главный защитник**. Внесите в `blacklist` все папки и файлы, которые должны оставаться на рабочем столе. Это могут быть точные имена, целые директории или шаблоны (например, `*.psd`).
* **Ограничение длины пути в Windows**. По умолчанию в Windows есть ограничение на длину пути в ~260 символов. Если вы создаёте глубоко вложенные папки, Butler может упереться в этот лимит. Это не баг, а особенность системы.
* **Заблокированные файлы**. Скрипт не сможет переместить файл, если он в данный момент открыт в другой программе. В логах будет видно, какие файлы были пропущены.
* **Символические ссылки игнорируются**. Чтобы случайно не переместить что-то важное из другой части системы, Butler намеренно не трогает символические ссылки.
